<?php session_start(); ?>
  <?php
  include("../includes/session.php");
  include("../includes/accounts_rights.php");
  require ("../includes/dbconnection.php");
  include("header.php");
  function psum($d1, $d2){
  $sql = "select sum(amount) from account_entry where (ac_cat_id = 2 OR ac_cat_id = 7 OR ac_cat_id = 8 OR ac_cat_id = 9 OR ac_cat_id = 1 OR ac_cat_id = 10 OR ac_cat_id = 11) AND date >= '$d1' AND date <= '$d2'";
$q = mysql_query($sql);
$row = mysql_fetch_array($q);
if($row[0] > 0) 
        {
            echo number_format($row[0], 0);
        }
    else
        {
            echo '--';
        }
}
function rsum($d1, $d2){
  $sql = "select sum(amount) from account_entry where (ac_cat_id = 3 OR ac_cat_id = 4 OR ac_cat_id = 6) AND date >= '$d1' AND date <= '$d2'";
$q = mysql_query($sql);
$row = mysql_fetch_array($q);
if($row[0] > 0) 
        {
            echo number_format($row[0], 0);
        }
    else
        {
            echo '--';
        }
}
function tot($d1, $d2){
  $sql = "select sum(amount) from account_entry where (ac_cat_id = 2 OR ac_cat_id = 7 OR ac_cat_id = 8 OR ac_cat_id = 9 OR ac_cat_id = 1 OR ac_cat_id = 10 OR ac_cat_id = 11) AND date >= '$d1' AND date <= '$d2'";
$q = mysql_query($sql);
$row = mysql_fetch_array($q);
$first = $row[0];
$sql = "select sum(amount) from account_entry where (ac_cat_id = 3 OR ac_cat_id = 4 OR ac_cat_id = 6) AND date >= '$d1' AND date <= '$d2'";
$q = mysql_query($sql);
$row = mysql_fetch_array($q);
$second = $row[0];
$total = $second-$first;
if($total >= 0) 
        {
            echo '<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 margin-bottom-10">
					<a class="dashboard-stat dashboard-stat-light green-haze">
					<div class="visual">
						<i class="fa fa-mortar-board fa-icon-medium"></i>
					</div>
					<div class="details">
						<div class="number">
							 '.number_format($total, 0).'
						</div>
						<div class="desc">
							 Surplus
						</div>
					</div>
					</a>
				</div>';
        }
    else
        {
            echo '<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 margin-bottom-10">
					<a class="dashboard-stat dashboard-stat-light red-intense">
					<div class="visual">
						<i class="fa fa-mortar-board fa-icon-medium"></i>
					</div>
					<div class="details">
						<div class="number">
							 '.number_format($total, 0).'
						</div>
						<div class="desc">
							 Deficit
						</div>
					</div>
					</a>
				</div>';
        }
}
function psumi($h){
$d1 =$_REQUEST['date_id1'];
$d2 =$_REQUEST['date_id2'];
$sql = "select sum(amount) from account_entry where account_head = $h AND date >= '$d1' AND date <= '$d2'";
$q = mysql_query($sql);
$row = mysql_fetch_array($q);
$second = $row[0];
echo number_format($second, 0);
}
function head_name($h){
$result = mysql_query("select * from accounts_head where account_head_id = $h");
$counter = 0;
if (!$result) 
	{
    die("Query to show fields from table failed");
	}
$numberOfRows = MYSQL_NUMROWS($result);
If ($numberOfRows == 0) 
	{
	echo 'NIl';
	}
else if ($numberOfRows > 0) 
	{
	$i=0;
	while ($i<$numberOfRows)
		{		
			$en_name = MYSQL_RESULT($result,$i,"account_head_name");
			echo $en_name;
$i++;		
		}
	}
}
?>
<?php
date_default_timezone_set("Asia/Karachi");
$d1 =$_REQUEST['date_id1'];
$d2 =$_REQUEST['date_id2'];
?>
<?php echo $main_header; ?>
<?php echo $tool_bar; ?>
<?php echo $start_menu; ?>
<?php echo $search_bar; ?>
<?php echo $main_menu; ?>
<!-- BEGIN PAGE CONTAINER -->
<div class="page-container">
	<!-- BEGIN PAGE HEAD -->
	<div class="page-head">
		<div class="container">
			<!-- BEGIN PAGE TITLE -->
			<div class="page-title">
				<h1>Receipts and Payments <small><?php echo $month_n; ?>-<?php echo $year; ?></small></h1>

			</div>
			<!-- END PAGE TITLE -->
			<!-- BEGIN PAGE TOOLBAR -->
			<div class="page-toolbar">
			</div>
			<!-- END PAGE TOOLBAR -->
		</div>
	</div>
	<!-- END PAGE HEAD -->
	<!-- BEGIN PAGE CONTENT -->
	<div class="page-content">
		<div class="container">

			<!-- BEGIN PAGE BREADCRUMB -->
			<ul class="page-breadcrumb breadcrumb">
				<li>
					<a href="admin-home">Home</a><i class="fa fa-circle"></i>
				</li>
				<li class="active">
					 Receipts and Payments Account for the period <b><?php $date1=date_create($d1); 
echo date_format($date1,"M d, Y");
 ?> to <?php $date2=date_create($d2); 
echo date_format($date2,"M d, Y"); ?></b>
				</li>
			</ul>
			<!-- END PAGE BREADCRUMB -->
			<!-- BEGIN PAGE CONTENT INNER -->
			<div class="row">
							<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 margin-bottom-10">
					<a class="dashboard-stat dashboard-stat-light green-haze" href="admin-home">
					<div class="visual">
						<i class="fa fa-mortar-board fa-icon-medium"></i>
					</div>
					<div class="details">
						<div class="number">
							 <?php echo rsum("$d1","$d2"); ?>
						</div>
						<div class="desc">
							 Total Receipts
						</div>
					</div>
					</a>
				</div>
				<div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 margin-bottom-10">
					<a class="dashboard-stat dashboard-stat-light red-intense" href="admin-home">
					<div class="visual">
						<i class="fa fa-mortar-board fa-icon-medium"></i>
					</div>
					<div class="details">
						<div class="number">
							 <?php echo psum("$d1","$d2"); ?>
						</div>
						<div class="desc">
							 Total Payments
						</div>
					</div>
					</a>
				</div>
				<?php echo tot("$d1","$d2"); ?>
				<div class="col-md-6">
					<!-- BEGIN SAMPLE TABLE PORTLET-->
					<div class="portlet light">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-money font-green-sharp"></i>
								<span class="caption-subject font-green-sharp bold uppercase">Receipts for <?php echo $month_n; ?>-<?php echo $year; ?></span>
							</div>
							<div class="tools">
								<a href="javascript:;" class="collapse">
								</a>
								<a href="javascript:;" class="remove">
								</a>
							</div>
						</div>
						<div class="portlet-body">
							<div class="table-scrollable">
								<table class="table table-hover">
								<thead>
								<tr>
								<th>
									 #
								</th>
								<th>
									 Head
								</th>
								<th>
									 Amount
								</th>
								<?php 
// sending query
$result = mysql_query("SELECT * FROM account_entry WHERE (ac_cat_id = 3 OR ac_cat_id = 4 OR ac_cat_id = 6) AND date >= '$d1' AND date <= '$d2' GROUP BY account_head");
$counter = 0;
if (!$result) 
	{
    die("Query to show fields from table failed");
	}
$numberOfRows = MYSQL_NUMROWS($result);
If ($numberOfRows == 0) 
	{
	echo 'No Entry Found!';
	}
else if ($numberOfRows > 0) 
	{
	$i=0;
	while ($i<$numberOfRows)
		{		
			$en_id = MYSQL_RESULT($result,$i,"entry_id");
			$en_date = MYSQL_RESULT($result,$i,"date");
			$en_vou = MYSQL_RESULT($result,$i,"voucher_id");
			$en_des = MYSQL_RESULT($result,$i,"description");
			$en_ven = MYSQL_RESULT($result,$i,"vendor_id");
			$en_cat = MYSQL_RESULT($result,$i,"ac_cat_id");
			$en_head = MYSQL_RESULT($result,$i,"account_head");
			$en_amu = MYSQL_RESULT($result,$i,"amount");
?>
							</tr>
								</thead>
								<tbody>
								<tr bgcolor="">
								<td>
									 <?php echo ++$counter; ?>
								</td>
								<td>
									 <a class="notes" href="#notes-d" data-toggle="modal" data-target="#notes-d" data-id="<?php echo $en_head; ?>" data-value="<?php echo psumi("$en_head"); ?>" data-id1="<?php echo $d1; ?>" data-id2="<?php echo $d2; ?>"><?php echo head_name("$en_head"); ?></a>
								</td>
								<td>
									 <?php echo psumi("$en_head"); ?>
								</td>
							</tr>
							<?php 	
		$i++;		
		}
	}	
?>
								<tr bgcolor="#44b6ae">
								<td colspan="2" align="right">
									 <strong>Total</strong>
								</td>
								<td>
									 <strong><?php echo rsum("$d1","$d2"); ?></strong>
								</td>
							</tr>
								</tbody>
								</table>
							</div>
						</div>
					</div>
					</div>
					<!-- END SAMPLE TABLE PORTLET-->
					<div class="row">
				<div class="col-md-6">
					<!-- BEGIN SAMPLE TABLE PORTLET-->
					<div class="portlet light">
						<div class="portlet-title">
							<div class="caption">
								<i class="fa fa-list-ul font-green-sharp"></i>
								<span class="caption-subject font-green-sharp bold uppercase">Payments for <?php echo $month_n; ?>-<?php echo $year; ?></span>
							</div>
							<div class="tools">
								<a href="javascript:;" class="collapse">
								</a>
								<a href="javascript:;" class="remove">
								</a>
							</div>
						</div>
						<div class="portlet-body">
							<div class="table-scrollable">
								<table class="table table-hover">
								<thead>
								<tr>
								<th>
									 #
								</th>
								<th>
									 Head
								</th>
								<th>
									 Amount
								</th>
								<?php 
// sending query
$result = mysql_query("SELECT * FROM account_entry WHERE (ac_cat_id = 2 OR ac_cat_id = 7 OR ac_cat_id = 8 OR ac_cat_id = 9 OR ac_cat_id = 1 OR ac_cat_id = 10 OR ac_cat_id = 11) AND date >= '$d1' AND date <= '$d2' GROUP BY account_head");
$counter = 0;
if (!$result) 
	{
    die("Query to show fields from table failed");
	}
$numberOfRows = MYSQL_NUMROWS($result);
If ($numberOfRows == 0) 
	{
	echo 'No Entry Found!';
	}
else if ($numberOfRows > 0) 
	{
	$i=0;
	while ($i<$numberOfRows)
		{		
			$en_id = MYSQL_RESULT($result,$i,"entry_id");
			$en_date = MYSQL_RESULT($result,$i,"date");
			$en_vou = MYSQL_RESULT($result,$i,"voucher_id");
			$en_des = MYSQL_RESULT($result,$i,"description");
			$en_ven = MYSQL_RESULT($result,$i,"vendor_id");
			$en_cat = MYSQL_RESULT($result,$i,"ac_cat_id");
			$en_head = MYSQL_RESULT($result,$i,"account_head");
			$en_amu = MYSQL_RESULT($result,$i,"amount");
?>
							</tr>
								</thead>
								<tbody>
								<tr bgcolor="">
								<td>
									 <?php echo ++$counter; ?>
								</td>
								<td>
									 <a class="notes" href="#notes-d" data-toggle="modal" data-target="#notes-d" data-id="<?php echo $en_head; ?>" data-value="<?php echo psumi("$en_head"); ?>" data-id1="<?php echo $d1; ?>" data-id2="<?php echo $d2; ?>"><?php echo head_name("$en_head"); ?></a>
								</td>
								<td>
									 <?php echo psumi("$en_head"); ?>
								</td>
							</tr>
							<?php 	
		$i++;		
		}
	}	
?>
								<tr bgcolor="#e35b5a">
								<td colspan="2" align="right">
									 <strong>Total</strong>
								</td>
								<td>
									<strong><?php echo psum("$d1","$d2"); ?></strong>
								</td>
							</tr>
								</tbody>
								</table>
							</div>
						</div>
					</div>
					</div>
<div class="modal fade bs-modal-lg" id="notes-d" tabindex="-1" role="dialog" aria-hidden="true">
								<div class="modal-dialog modal-lg">
									<div class="modal-content">


        </div>
    </div>
</div>
				</div>
			</div>
			<!-- END PAGE CONTENT INNER -->
		</div>
	</div>
	<!-- END PAGE CONTENT -->
</div>
<!-- END PAGE CONTAINER -->
<div id="full-width" class="modal container fade" tabindex="-1">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
								</div>
								<div class="portlet box green">
									<div class="portlet-title">
										<div class="caption">
											<i class="fa fa-chevron-right"></i>Search For Previous Month Class History
										</div>
									</div>
									<div class="portlet-body form">
										<!-- BEGIN FORM-->
										<form action="receipt-payment-search" method="GET" class="form-horizontal">
											<div class="form-body">
												<h3 class="form-section">Please Select Desired Month and Year</h3>
												<div class="row">
													<div class="col-md-6">
														<div class="form-group">
															<label class="control-label col-md-3">Month</label>
															<div class="col-md-9">
																<select required class="form-control" name="month_id"  id="month_id">

																	<?php // source 1: http://www.dmxzone.com/showDetail.asp?NewsId=5102&TypeId=25
			  	// source 2: http://localhost/phpmyadmin/index.php?db=mydbase&token=651c0063e511c381c9c82ce1fe9b6854
				$result = mysql_query("SELECT * FROM month ORDER BY month_id ");			  	
				do {  ?>
  <option value="<?php echo $row['num'];?>"><?php echo $row['month_name'];?> </option>
  <?php } while ($row = mysql_fetch_assoc($result)); ?>
</select>
																<span class="help-block">
																Please Select Month. </span>
															</div>
														</div>
													</div>
													<!--/span-->
													<div class="col-md-6">
														<div class="form-group">
															<label class="control-label col-md-3">Year</label>
															<div class="col-md-9">
															<select required class="form-control" name="year_id"  id="year_id">
																<?php // source 1: http://www.dmxzone.com/showDetail.asp?NewsId=5102&TypeId=25
			  	// source 2: http://localhost/phpmyadmin/index.php?db=mydbase&token=651c0063e511c381c9c82ce1fe9b6854
				$result = mysql_query("SELECT * FROM school_yr ORDER BY year_id ");			  	
				do {  ?>
  <option value="<?php echo $row['school_year'];?>"><?php echo $row['school_year'];?> </option>
  <?php } while ($row = mysql_fetch_assoc($result)); ?>
</select>
<span class="help-block">
																Please Select Year. </span>
<input type="hidden" id="$month =$_REQUEST['mon'];" name="$month =$_REQUEST['mon'];"  value="<?php echo $month_n; ?>" />
<input type="hidden" id="$month =$_REQUEST['mon'];" name="$month =$_REQUEST['mon'];"  value="<?php echo $month_n; ?>" />

															</div>
														</div>
													</div>
													<!--/span-->
												</div>
												<!--/row-->
												</div>
											<div class="form-actions">
												<div class="row">
													<div class="col-md-6">
														<div class="row">
															<div class="col-md-offset-3 col-md-9">
																<button type="submit" class="btn green">Submit</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</form>
										<!-- END FORM-->
									</div>
								</div>
				</div>
<?php echo $fot; ?>
<script>
$('.notes').click(function(){
    var famID=$(this).attr('data-id');
    var famValue=$(this).attr('data-value');
    var famID1=$(this).attr('data-id1');
    var famID2=$(this).attr('data-id2');

    $.ajax({url:"entry-details-generated.php?famID="+famID+"&famValue="+famValue+"&famID1="+famID1+"&famID2="+famID2,cache:false,success:function(result){
        $(".modal-content").html(result);
    }});
});
</script>